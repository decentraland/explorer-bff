syntax = "proto3";

message Subscription {
  int32 id = 1;
}

message SubscriptionRequest {
  string topic = 1;
  bool fromPeers = 2;
}

message UnsubscriptionRequest {
  int32 id = 1;
  bool fromPeers = 2;
}

message UnsubscriptionResult {
  bool ok = 1;
}

message PeerTopicSubscriptionResultElem {
  bytes payload = 1;
  string topic = 2;
  string sender = 3;
}

message SystemTopicSubscriptionResultElem {
  bytes payload = 1;
  string topic = 2;
}

message PublishToTopicRequest {
  string topic = 1;
  bytes payload = 2;
}

message PublishToTopicResult {
  bool ok = 1;
}

service CommsService {
  rpc Subscribe(SubscriptionRequest) returns (Subscription) {}
  rpc Unsubscribe(UnsubscriptionRequest) returns (UnsubscriptionResult) {}

  rpc GetSystemMessages(Subscription) returns (stream SystemTopicSubscriptionResultElem) {}
  rpc GetPeerMessages(Subscription) returns (stream PeerTopicSubscriptionResultElem) {}

  // send a message to a topic
  rpc PublishToTopic(PublishToTopicRequest) returns (PublishToTopicResult) {}
}

